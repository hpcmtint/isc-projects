<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1178px" preserveAspectRatio="none" style="width:568px;height:1178px;background:#FFFFFF;" version="1.1" viewBox="0 0 568 1178" width="568px" zoomAndPan="magnify"><defs><filter height="300%" id="f6jeyhg6g5rws" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><ellipse cx="281" cy="20" fill="#000000" filter="url(#f6jeyhg6g5rws)" rx="10" ry="10" style="stroke:none;stroke-width:1.0;"/><polygon fill="#FEFECE" filter="url(#f6jeyhg6g5rws)" points="163,50,399,50,411,62,399,74,163,74,151,62,163,50" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="236" x="163" y="65.8081">Should regen certs or hasn't private key?</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="22" x="129" y="59.4058">YES</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="17" x="411" y="59.4058">NO</text><rect fill="#FEFECE" filter="url(#f6jeyhg6g5rws)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="207" x="37.5" y="84"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="187" x="47.5" y="105.1387">Generate CSR and private key</text><rect fill="#FEFECE" filter="url(#f6jeyhg6g5rws)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="161" x="60.5" y="137.9688"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="141" x="70.5" y="159.1074">Save private key to file</text><polygon fill="#FEFECE" filter="url(#f6jeyhg6g5rws)" points="97,191.9375,175,191.9375,185,225.9063,107,225.9063" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="107" y="213.0762">KeyPEMFile</text><polygon fill="#FEFECE" filter="url(#f6jeyhg6g5rws)" points="377,84,455,84,465,117.9688,387,117.9688" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="387" y="105.1387">KeyPEMFile</text><rect fill="#FEFECE" filter="url(#f6jeyhg6g5rws)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="107" x="367.5" y="137.9688"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="87" x="377.5" y="159.1074">Generate CSR</text><polygon fill="#FEFECE" filter="url(#f6jeyhg6g5rws)" points="281,231.9063,293,243.9063,281,255.9063,269,243.9063,281,231.9063" style="stroke:#A80036;stroke-width:1.5;"/><polygon fill="#FEFECE" filter="url(#f6jeyhg6g5rws)" points="229,275.9063,333,275.9063,345,287.9063,333,299.9063,229,299.9063,217,287.9063,229,275.9063" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="104" x="229" y="291.7144">Has server token?</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="22" x="195" y="285.312">YES</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="17" x="345" y="285.312">NO</text><rect fill="#FEFECE" filter="url(#f6jeyhg6g5rws)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="155" x="109.5" y="309.9063"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="135" x="119.5" y="331.0449">Agent Token is empty</text><rect fill="#FEFECE" filter="url(#f6jeyhg6g5rws)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="181" x="284.5" y="309.9063"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="161" x="294.5" y="331.0449">AgentToken = Fingerprint</text><rect fill="#FEFECE" filter="url(#f6jeyhg6g5rws)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="172" x="289" y="363.875"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="152" x="299" y="385.0137">Save Agent Token to file</text><polygon fill="#FEFECE" filter="url(#f6jeyhg6g5rws)" points="317,417.8438,423,417.8438,433,451.8125,327,451.8125" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="96" x="327" y="438.9824">AgentTokenFile</text><polygon fill="#FEFECE" filter="url(#f6jeyhg6g5rws)" points="281,457.8125,293,469.8125,281,481.8125,269,469.8125,281,457.8125" style="stroke:#A80036;stroke-width:1.5;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="127.5" x2="436" y1="501.8125" y2="501.8125"/><polygon fill="#FEFECE" filter="url(#f6jeyhg6g5rws)" points="86.5,521.8125,178.5,521.8125,168.5,555.7813,76.5,555.7813" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="82" x="86.5" y="542.9512">Server Token</text><path d="M206.5,526.2305 L206.5,551.3633 L366.5,551.3633 L366.5,536.2305 L356.5,526.2305 L206.5,526.2305 " fill="#FBFB77" filter="url(#f6jeyhg6g5rws)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M356.5,526.2305 L356.5,536.2305 L366.5,536.2305 L356.5,526.2305 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="139" x="212.5" y="543.2974">One of them is empty</text><polygon fill="#FEFECE" filter="url(#f6jeyhg6g5rws)" points="396.5,521.8125,485.5,521.8125,475.5,555.7813,386.5,555.7813" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="79" x="396.5" y="542.9512">Agent Token</text><line style="stroke:#A80036;stroke-width:1.5;" x1="127.5" x2="436" y1="575.7813" y2="575.7813"/><line style="stroke:#A80036;stroke-width:1.5;" x1="267" x2="542" y1="595.7813" y2="595.7813"/><rect fill="#FEFECE" filter="url(#f6jeyhg6g5rws)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="112" x="211" y="615.7813"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="92" x="221" y="636.9199">Send to server</text><line style="stroke:#A80036;stroke-width:1.5;" x1="209" x2="484" y1="669.75" y2="669.75"/><line style="stroke:#A80036;stroke-width:1.5;" x1="73" x2="343.5" y1="689.75" y2="689.75"/><path d="M146,699.75 L146,731.0156 L126,735.0156 L146,739.0156 L146,770.2813 A0,0 0 0 0 146,770.2813 L261,770.2813 A0,0 0 0 0 261,770.2813 L261,709.75 L251,699.75 L146,699.75 A0,0 0 0 0 146,699.75 " fill="#FBFB77" filter="url(#f6jeyhg6g5rws)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M251,699.75 L251,709.75 L261,709.75 L251,699.75 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="84" x="152" y="716.8169">Fingerprint of</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="90" x="152" y="731.9497">this certificate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="55" x="152" y="747.0825">is stored</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="75" x="152" y="762.2153">in database</text><polygon fill="#FEFECE" filter="url(#f6jeyhg6g5rws)" points="30,718.0313,126,718.0313,116,752,20,752" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="86" x="30" y="739.1699">Agent CA cert</text><polygon fill="#FEFECE" filter="url(#f6jeyhg6g5rws)" points="299,718.0313,398,718.0313,388,752,289,752" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="89" x="299" y="739.1699">Server CA cert</text><line style="stroke:#A80036;stroke-width:1.5;" x1="73" x2="343.5" y1="790.2813" y2="790.2813"/><rect fill="#FEFECE" filter="url(#f6jeyhg6g5rws)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="86" x="166" y="826.7813"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="66" x="176" y="847.9199">Save certs</text><line style="stroke:#A80036;stroke-width:1.5;" x1="148.5" x2="266" y1="880.75" y2="880.75"/><polygon fill="#FEFECE" filter="url(#f6jeyhg6g5rws)" points="105.5,900.75,181.5,900.75,191.5,934.7188,115.5,934.7188" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="66" x="115.5" y="921.8887">RootCAFile</text><polygon fill="#FEFECE" filter="url(#f6jeyhg6g5rws)" points="219.5,900.75,302.5,900.75,312.5,934.7188,229.5,934.7188" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="73" x="229.5" y="921.8887">CertPEMFile</text><polygon fill="#FEFECE" filter="url(#f6jeyhg6g5rws)" points="450,807.75,528,807.75,518,841.7188,440,841.7188" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="450" y="828.8887">Machine ID</text><line style="stroke:#A80036;stroke-width:1.5;" x1="267" x2="484" y1="954.7188" y2="954.7188"/><line style="stroke:#A80036;stroke-width:1.5;" x1="267" x2="542" y1="974.7188" y2="974.7188"/><rect fill="#FEFECE" filter="url(#f6jeyhg6g5rws)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="88" x="237" y="1043.1211"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="247" y="1064.2598">Ping agent</text><polygon fill="#FEFECE" filter="url(#f6jeyhg6g5rws)" points="208.5,994.7188,353.5,994.7188,365.5,1006.7188,353.5,1018.7188,208.5,1018.7188,196.5,1006.7188,208.5,994.7188" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="22" x="285" y="1028.9292">YES</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="145" x="208.5" y="1010.5269">Is server token provided?</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="17" x="365.5" y="1004.1245">NO</text><polygon fill="#FEFECE" filter="url(#f6jeyhg6g5rws)" points="281,1097.0898,293,1109.0898,281,1121.0898,269,1109.0898,281,1097.0898" style="stroke:#A80036;stroke-width:1.5;"/><ellipse cx="281" cy="1151.0898" fill="#FFFFFF" filter="url(#f6jeyhg6g5rws)" rx="10" ry="10" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:2.5;" x1="274.8128" x2="287.1872" y1="1144.9027" y2="1157.277"/><line style="stroke:#000000;stroke-width:2.5;" x1="287.1872" x2="274.8128" y1="1144.9027" y2="1157.277"/><line style="stroke:#A80036;stroke-width:1.5;" x1="141" x2="141" y1="117.9688" y2="137.9688"/><polygon fill="#A80036" points="137,127.9688,141,137.9688,145,127.9688,141,131.9688" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="141" x2="141" y1="171.9375" y2="191.9375"/><polygon fill="#A80036" points="137,181.9375,141,191.9375,145,181.9375,141,185.9375" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="421" x2="421" y1="117.9688" y2="137.9688"/><polygon fill="#A80036" points="417,127.9688,421,137.9688,425,127.9688,421,131.9688" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="151" x2="141" y1="62" y2="62"/><line style="stroke:#A80036;stroke-width:1.5;" x1="141" x2="141" y1="62" y2="84"/><polygon fill="#A80036" points="137,74,141,84,145,74,141,78" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="411" x2="421" y1="62" y2="62"/><line style="stroke:#A80036;stroke-width:1.5;" x1="421" x2="421" y1="62" y2="84"/><polygon fill="#A80036" points="417,74,421,84,425,74,421,78" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="141" x2="141" y1="225.9063" y2="243.9063"/><line style="stroke:#A80036;stroke-width:1.5;" x1="141" x2="269" y1="243.9063" y2="243.9063"/><polygon fill="#A80036" points="259,239.9063,269,243.9063,259,247.9063,263,243.9063" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="421" x2="421" y1="171.9375" y2="243.9063"/><line style="stroke:#A80036;stroke-width:1.5;" x1="421" x2="293" y1="243.9063" y2="243.9063"/><polygon fill="#A80036" points="303,239.9063,293,243.9063,303,247.9063,299,243.9063" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="281" x2="281" y1="30" y2="50"/><polygon fill="#A80036" points="277,40,281,50,285,40,281,44" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="375" x2="375" y1="343.875" y2="363.875"/><polygon fill="#A80036" points="371,353.875,375,363.875,379,353.875,375,357.875" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="375" x2="375" y1="397.8438" y2="417.8438"/><polygon fill="#A80036" points="371,407.8438,375,417.8438,379,407.8438,375,411.8438" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="217" x2="187" y1="287.9063" y2="287.9063"/><line style="stroke:#A80036;stroke-width:1.5;" x1="187" x2="187" y1="287.9063" y2="309.9063"/><polygon fill="#A80036" points="183,299.9063,187,309.9063,191,299.9063,187,303.9063" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="345" x2="375" y1="287.9063" y2="287.9063"/><line style="stroke:#A80036;stroke-width:1.5;" x1="375" x2="375" y1="287.9063" y2="309.9063"/><polygon fill="#A80036" points="371,299.9063,375,309.9063,379,299.9063,375,303.9063" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="187" x2="187" y1="343.875" y2="469.8125"/><line style="stroke:#A80036;stroke-width:1.5;" x1="187" x2="269" y1="469.8125" y2="469.8125"/><polygon fill="#A80036" points="259,465.8125,269,469.8125,259,473.8125,263,469.8125" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="375" x2="375" y1="451.8125" y2="469.8125"/><line style="stroke:#A80036;stroke-width:1.5;" x1="375" x2="293" y1="469.8125" y2="469.8125"/><polygon fill="#A80036" points="303,465.8125,293,469.8125,303,473.8125,299,469.8125" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="281" x2="281" y1="255.9063" y2="275.9063"/><polygon fill="#A80036" points="277,265.9063,281,275.9063,285,265.9063,281,269.9063" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="127.5" x2="127.5" y1="503.3125" y2="521.8125"/><polygon fill="#A80036" points="123.5,511.8125,127.5,521.8125,131.5,511.8125,127.5,515.8125" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="436" x2="436" y1="503.3125" y2="521.8125"/><polygon fill="#A80036" points="432,511.8125,436,521.8125,440,511.8125,436,515.8125" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="127.5" x2="127.5" y1="555.7813" y2="575.7813"/><polygon fill="#A80036" points="123.5,565.7813,127.5,575.7813,131.5,565.7813,127.5,569.7813" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="436" x2="436" y1="555.7813" y2="575.7813"/><polygon fill="#A80036" points="432,565.7813,436,575.7813,440,565.7813,436,569.7813" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="281" x2="281" y1="481.8125" y2="501.8125"/><polygon fill="#A80036" points="277,491.8125,281,501.8125,285,491.8125,281,495.8125" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="73" x2="73" y1="691.25" y2="718.0313"/><polygon fill="#A80036" points="69,708.0313,73,718.0313,77,708.0313,73,712.0313" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="343.5" x2="343.5" y1="691.25" y2="718.0313"/><polygon fill="#A80036" points="339.5,708.0313,343.5,718.0313,347.5,708.0313,343.5,712.0313" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="73" x2="73" y1="752" y2="790.2813"/><polygon fill="#A80036" points="69,780.2813,73,790.2813,77,780.2813,73,784.2813" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="343.5" x2="343.5" y1="752" y2="790.2813"/><polygon fill="#A80036" points="339.5,780.2813,343.5,790.2813,347.5,780.2813,343.5,784.2813" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="209" x2="209" y1="791.7813" y2="826.7813"/><polygon fill="#A80036" points="205,816.7813,209,826.7813,213,816.7813,209,820.7813" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="148.5" x2="148.5" y1="882.25" y2="900.75"/><polygon fill="#A80036" points="144.5,890.75,148.5,900.75,152.5,890.75,148.5,894.75" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="266" x2="266" y1="882.25" y2="900.75"/><polygon fill="#A80036" points="262,890.75,266,900.75,270,890.75,266,894.75" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="209" x2="209" y1="860.75" y2="880.75"/><polygon fill="#A80036" points="205,870.75,209,880.75,213,870.75,209,874.75" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="209" x2="209" y1="671.25" y2="689.75"/><polygon fill="#A80036" points="205,679.75,209,689.75,213,679.75,209,683.75" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="484" x2="484" y1="671.25" y2="807.75"/><polygon fill="#A80036" points="480,797.75,484,807.75,488,797.75,484,801.75" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="484" x2="484" y1="841.7188" y2="954.7188"/><polygon fill="#A80036" points="480,944.7188,484,954.7188,488,944.7188,484,948.7188" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="267" x2="267" y1="649.75" y2="669.75"/><polygon fill="#A80036" points="263,659.75,267,669.75,271,659.75,267,663.75" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="267" x2="267" y1="597.2813" y2="615.7813"/><polygon fill="#A80036" points="263,605.7813,267,615.7813,271,605.7813,267,609.7813" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="542" x2="542" y1="597.2813" y2="974.7188"/><polygon fill="#A80036" points="538,964.7188,542,974.7188,546,964.7188,542,968.7188" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="267" x2="267" y1="956.2188" y2="974.7188"/><polygon fill="#A80036" points="263,964.7188,267,974.7188,271,964.7188,267,968.7188" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="281" x2="281" y1="577.2813" y2="595.7813"/><polygon fill="#A80036" points="277,585.7813,281,595.7813,285,585.7813,281,589.7813" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="281" x2="281" y1="1018.7188" y2="1043.1211"/><polygon fill="#A80036" points="277,1033.1211,281,1043.1211,285,1033.1211,281,1037.1211" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="365.5" x2="377.5" y1="1006.7188" y2="1006.7188"/><polygon fill="#A80036" points="373.5,1050.1055,377.5,1060.1055,381.5,1050.1055,377.5,1054.1055" style="stroke:#A80036;stroke-width:1.5;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="377.5" x2="377.5" y1="1006.7188" y2="1109.0898"/><line style="stroke:#A80036;stroke-width:1.5;" x1="377.5" x2="293" y1="1109.0898" y2="1109.0898"/><polygon fill="#A80036" points="303,1105.0898,293,1109.0898,303,1113.0898,299,1109.0898" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="281" x2="281" y1="1077.0898" y2="1097.0898"/><polygon fill="#A80036" points="277,1087.0898,281,1097.0898,285,1087.0898,281,1091.0898" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="281" x2="281" y1="976.2188" y2="994.7188"/><polygon fill="#A80036" points="277,984.7188,281,994.7188,285,984.7188,281,988.7188" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="281" x2="281" y1="1121.0898" y2="1141.0898"/><polygon fill="#A80036" points="277,1131.0898,281,1141.0898,285,1131.0898,281,1135.0898" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[3ed0e98f2b48fcdbaee8245d46bce103]
@startuml

start
if (Should regen certs or hasn't private key?) is (YES) then
    :Generate CSR and private key;
    :Save private key to file;
    :KeyPEMFile\\
else (NO)
    :KeyPEMFile\\
    :Generate CSR;
endif

if (Has server token?) is (YES) then
    :Agent Token is empty;
else (NO)
    :AgentToken = Fingerprint;
    :Save Agent Token to file;
    :AgentTokenFile\\
endif

split
    :Server Token/
split again
    :Agent Token/
end split
floating note left: One of them is empty

split
    :Send to server;
    split
        split
            :Agent CA cert/
            note right
                Fingerprint of
                this certificate 
                is stored
                in database
            end note
        split again
            :Server CA cert/
        end split
        :Save certs;
        split
            :RootCAFile\\
            detach
        split again
            :CertPEMFile\\
            detach
        end split
    split again
        :Machine ID/
    end split

split again
end split

if (Is server token provided?) is (YES) then
    :Ping agent;
else (NO)
endif
end
@enduml

PlantUML version 1.2021.9(Sun Jul 25 12:13:56 CEST 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>