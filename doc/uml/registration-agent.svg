<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1166px" preserveAspectRatio="none" style="width:599px;height:1166px;background:#FFFFFF;" version="1.1" viewBox="0 0 599 1166" width="599px" zoomAndPan="magnify"><defs><filter height="300%" id="fqo7wnu0z4mvn" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><ellipse cx="300" cy="20" fill="#000000" filter="url(#fqo7wnu0z4mvn)" rx="10" ry="10" style="stroke:none;stroke-width:1.0;"/><polygon fill="#FEFECE" filter="url(#fqo7wnu0z4mvn)" points="182,50,418,50,430,62,418,74,182,74,170,62,182,50" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="236" x="182" y="65.8081">Should regen certs or hasn't private key?</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="22" x="148" y="59.4058">YES</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="17" x="430" y="59.4058">NO</text><rect fill="#FEFECE" filter="url(#fqo7wnu0z4mvn)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="207" x="56.5" y="84"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="187" x="66.5" y="105.1387">Generate CSR and private key</text><rect fill="#FEFECE" filter="url(#fqo7wnu0z4mvn)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="161" x="79.5" y="137.9688"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="141" x="89.5" y="159.1074">Save private key to file</text><polygon fill="#FEFECE" filter="url(#fqo7wnu0z4mvn)" points="116,191.9375,194,191.9375,204,225.9063,126,225.9063" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="126" y="213.0762">KeyPEMFile</text><rect fill="#FEFECE" filter="url(#fqo7wnu0z4mvn)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="295" x="12.5" y="245.9063"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="275" x="22.5" y="267.0449">Save Agent Token (fingerprint of CSR) to file</text><polygon fill="#FEFECE" filter="url(#fqo7wnu0z4mvn)" points="102,299.875,208,299.875,218,333.8438,112,333.8438" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="96" x="112" y="321.0137">AgentTokenFile</text><rect fill="#FEFECE" filter="url(#fqo7wnu0z4mvn)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="146" x="367" y="84"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="126" x="377" y="105.1387">Read private key file</text><polygon fill="#FEFECE" filter="url(#fqo7wnu0z4mvn)" points="396,137.9688,474,137.9688,484,171.9375,406,171.9375" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="406" y="159.1074">KeyPEMFile</text><rect fill="#FEFECE" filter="url(#fqo7wnu0z4mvn)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="107" x="386.5" y="191.9375"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="87" x="396.5" y="213.0762">Generate CSR</text><rect fill="#FEFECE" filter="url(#fqo7wnu0z4mvn)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="187" x="346.5" y="245.9063"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="167" x="356.5" y="267.0449">Read agent token from file</text><polygon fill="#FEFECE" filter="url(#fqo7wnu0z4mvn)" points="382,299.875,488,299.875,498,333.8438,392,333.8438" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="96" x="392" y="321.0137">AgentTokenFile</text><polygon fill="#FEFECE" filter="url(#fqo7wnu0z4mvn)" points="300,339.8438,312,351.8438,300,363.8438,288,351.8438,300,339.8438" style="stroke:#A80036;stroke-width:1.5;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="176.5" x2="425" y1="383.8438" y2="383.8438"/><polygon fill="#FEFECE" filter="url(#fqo7wnu0z4mvn)" points="135.5,403.8438,227.5,403.8438,217.5,437.8125,125.5,437.8125" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="82" x="135.5" y="424.9824">Server Token</text><path d="M255.5,408.2617 L255.5,433.3945 A0,0 0 0 0 255.5,433.3945 L355.5,433.3945 A0,0 0 0 0 355.5,433.3945 L355.5,426.2617 L375.5,420.8281 L355.5,418.2617 L355.5,418.2617 L345.5,408.2617 L255.5,408.2617 A0,0 0 0 0 255.5,408.2617 " fill="#FBFB77" filter="url(#fqo7wnu0z4mvn)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M345.5,408.2617 L345.5,418.2617 L355.5,418.2617 L345.5,408.2617 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79" x="261.5" y="425.3286">It is required</text><polygon fill="#FEFECE" filter="url(#fqo7wnu0z4mvn)" points="385.5,403.8438,474.5,403.8438,464.5,437.8125,375.5,437.8125" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="79" x="385.5" y="424.9824">Agent Token</text><line style="stroke:#A80036;stroke-width:1.5;" x1="176.5" x2="425" y1="457.8125" y2="457.8125"/><line style="stroke:#A80036;stroke-width:1.5;" x1="286" x2="573" y1="477.8125" y2="477.8125"/><rect fill="#FEFECE" filter="url(#fqo7wnu0z4mvn)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="112" x="230" y="497.8125"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="92" x="240" y="518.9512">Send to server</text><rect fill="#000000" filter="url(#fqo7wnu0z4mvn)" height="6" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="548" x="11" y="551.7813"/><ellipse cx="228" cy="636.1836" fill="#FFFFFF" filter="url(#fqo7wnu0z4mvn)" rx="10" ry="10" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:2.5;" x1="221.8128" x2="234.1872" y1="629.9964" y2="642.3708"/><line style="stroke:#000000;stroke-width:2.5;" x1="234.1872" x2="221.8128" y1="629.9964" y2="642.3708"/><polygon fill="#FEFECE" filter="url(#fqo7wnu0z4mvn)" points="79.5,577.7813,376.5,577.7813,388.5,589.7813,376.5,601.7813,79.5,601.7813,67.5,589.7813,79.5,577.7813" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="22" x="232" y="611.9917">YES</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="297" x="79.5" y="593.5894">Server returns that the agent is already registered?</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="17" x="388.5" y="587.187">NO</text><line style="stroke:#A80036;stroke-width:1.5;" x1="92" x2="362.5" y1="688.1836" y2="688.1836"/><path d="M165,698.1836 L165,729.4492 L145,733.4492 L165,737.4492 L165,768.7148 A0,0 0 0 0 165,768.7148 L280,768.7148 A0,0 0 0 0 280,768.7148 L280,708.1836 L270,698.1836 L165,698.1836 A0,0 0 0 0 165,698.1836 " fill="#FBFB77" filter="url(#fqo7wnu0z4mvn)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M270,698.1836 L270,708.1836 L280,708.1836 L270,698.1836 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="84" x="171" y="715.2505">Fingerprint of</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="90" x="171" y="730.3833">this certificate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="55" x="171" y="745.5161">is stored</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="75" x="171" y="760.6489">in database</text><polygon fill="#FEFECE" filter="url(#fqo7wnu0z4mvn)" points="49,716.4648,145,716.4648,135,750.4336,39,750.4336" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="86" x="49" y="737.6035">Agent CA cert</text><polygon fill="#FEFECE" filter="url(#fqo7wnu0z4mvn)" points="318,716.4648,417,716.4648,407,750.4336,308,750.4336" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="89" x="318" y="737.6035">Server CA cert</text><line style="stroke:#A80036;stroke-width:1.5;" x1="92" x2="362.5" y1="788.7148" y2="788.7148"/><rect fill="#FEFECE" filter="url(#fqo7wnu0z4mvn)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="86" x="185" y="808.7148"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="66" x="195" y="829.8535">Save certs</text><line style="stroke:#A80036;stroke-width:1.5;" x1="167.5" x2="285" y1="862.6836" y2="862.6836"/><polygon fill="#FEFECE" filter="url(#fqo7wnu0z4mvn)" points="124.5,882.6836,200.5,882.6836,210.5,916.6523,134.5,916.6523" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="66" x="134.5" y="903.8223">RootCAFile</text><polygon fill="#FEFECE" filter="url(#fqo7wnu0z4mvn)" points="238.5,882.6836,321.5,882.6836,331.5,916.6523,248.5,916.6523" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="73" x="248.5" y="903.8223">CertPEMFile</text><polygon fill="#FEFECE" filter="url(#fqo7wnu0z4mvn)" points="469,739.2813,547,739.2813,537,773.25,459,773.25" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="469" y="760.4199">Machine ID</text><rect fill="#000000" filter="url(#fqo7wnu0z4mvn)" height="6" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="548" x="11" y="936.6523"/><line style="stroke:#A80036;stroke-width:1.5;" x1="286" x2="573" y1="962.6523" y2="962.6523"/><rect fill="#FEFECE" filter="url(#fqo7wnu0z4mvn)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="88" x="256" y="1031.0547"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="266" y="1052.1934">Ping agent</text><polygon fill="#FEFECE" filter="url(#fqo7wnu0z4mvn)" points="227.5,982.6523,372.5,982.6523,384.5,994.6523,372.5,1006.6523,227.5,1006.6523,215.5,994.6523,227.5,982.6523" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="22" x="304" y="1016.8628">YES</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="145" x="227.5" y="998.4604">Is server token provided?</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="17" x="384.5" y="992.0581">NO</text><polygon fill="#FEFECE" filter="url(#fqo7wnu0z4mvn)" points="300,1085.0234,312,1097.0234,300,1109.0234,288,1097.0234,300,1085.0234" style="stroke:#A80036;stroke-width:1.5;"/><ellipse cx="300" cy="1139.0234" fill="#FFFFFF" filter="url(#fqo7wnu0z4mvn)" rx="10" ry="10" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:2.5;" x1="293.8128" x2="306.1872" y1="1132.8363" y2="1145.2106"/><line style="stroke:#000000;stroke-width:2.5;" x1="306.1872" x2="293.8128" y1="1132.8363" y2="1145.2106"/><line style="stroke:#A80036;stroke-width:1.5;" x1="160" x2="160" y1="117.9688" y2="137.9688"/><polygon fill="#A80036" points="156,127.9688,160,137.9688,164,127.9688,160,131.9688" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="160" x2="160" y1="171.9375" y2="191.9375"/><polygon fill="#A80036" points="156,181.9375,160,191.9375,164,181.9375,160,185.9375" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="160" x2="160" y1="225.9063" y2="245.9063"/><polygon fill="#A80036" points="156,235.9063,160,245.9063,164,235.9063,160,239.9063" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="160" x2="160" y1="279.875" y2="299.875"/><polygon fill="#A80036" points="156,289.875,160,299.875,164,289.875,160,293.875" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="440" x2="440" y1="117.9688" y2="137.9688"/><polygon fill="#A80036" points="436,127.9688,440,137.9688,444,127.9688,440,131.9688" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="440" x2="440" y1="171.9375" y2="191.9375"/><polygon fill="#A80036" points="436,181.9375,440,191.9375,444,181.9375,440,185.9375" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="440" x2="440" y1="225.9063" y2="245.9063"/><polygon fill="#A80036" points="436,235.9063,440,245.9063,444,235.9063,440,239.9063" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="440" x2="440" y1="279.875" y2="299.875"/><polygon fill="#A80036" points="436,289.875,440,299.875,444,289.875,440,293.875" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="170" x2="160" y1="62" y2="62"/><line style="stroke:#A80036;stroke-width:1.5;" x1="160" x2="160" y1="62" y2="84"/><polygon fill="#A80036" points="156,74,160,84,164,74,160,78" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="430" x2="440" y1="62" y2="62"/><line style="stroke:#A80036;stroke-width:1.5;" x1="440" x2="440" y1="62" y2="84"/><polygon fill="#A80036" points="436,74,440,84,444,74,440,78" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="160" x2="160" y1="333.8438" y2="351.8438"/><line style="stroke:#A80036;stroke-width:1.5;" x1="160" x2="288" y1="351.8438" y2="351.8438"/><polygon fill="#A80036" points="278,347.8438,288,351.8438,278,355.8438,282,351.8438" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="440" x2="440" y1="333.8438" y2="351.8438"/><line style="stroke:#A80036;stroke-width:1.5;" x1="440" x2="312" y1="351.8438" y2="351.8438"/><polygon fill="#A80036" points="322,347.8438,312,351.8438,322,355.8438,318,351.8438" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="300" x2="300" y1="30" y2="50"/><polygon fill="#A80036" points="296,40,300,50,304,40,300,44" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="176.5" x2="176.5" y1="385.3438" y2="403.8438"/><polygon fill="#A80036" points="172.5,393.8438,176.5,403.8438,180.5,393.8438,176.5,397.8438" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="425" x2="425" y1="385.3438" y2="403.8438"/><polygon fill="#A80036" points="421,393.8438,425,403.8438,429,393.8438,425,397.8438" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="176.5" x2="176.5" y1="437.8125" y2="457.8125"/><polygon fill="#A80036" points="172.5,447.8125,176.5,457.8125,180.5,447.8125,176.5,451.8125" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="425" x2="425" y1="437.8125" y2="457.8125"/><polygon fill="#A80036" points="421,447.8125,425,457.8125,429,447.8125,425,451.8125" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="300" x2="300" y1="363.8438" y2="383.8438"/><polygon fill="#A80036" points="296,373.8438,300,383.8438,304,373.8438,300,377.8438" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="228" x2="228" y1="601.7813" y2="626.1836"/><polygon fill="#A80036" points="224,616.1836,228,626.1836,232,616.1836,228,620.1836" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="388.5" x2="400.5" y1="589.7813" y2="589.7813"/><polygon fill="#A80036" points="396.5,623.1836,400.5,633.1836,404.5,623.1836,400.5,627.1836" style="stroke:#A80036;stroke-width:1.5;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="400.5" x2="400.5" y1="589.7813" y2="668.1836"/><line style="stroke:#A80036;stroke-width:1.5;" x1="400.5" x2="228" y1="668.1836" y2="668.1836"/><line style="stroke:#A80036;stroke-width:1.5;" x1="228" x2="228" y1="668.1836" y2="688.1836"/><polygon fill="#A80036" points="224,678.1836,228,688.1836,232,678.1836,228,682.1836" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="92" x2="92" y1="689.6836" y2="716.4648"/><polygon fill="#A80036" points="88,706.4648,92,716.4648,96,706.4648,92,710.4648" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="362.5" x2="362.5" y1="689.6836" y2="716.4648"/><polygon fill="#A80036" points="358.5,706.4648,362.5,716.4648,366.5,706.4648,362.5,710.4648" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="92" x2="92" y1="750.4336" y2="788.7148"/><polygon fill="#A80036" points="88,778.7148,92,788.7148,96,778.7148,92,782.7148" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="362.5" x2="362.5" y1="750.4336" y2="788.7148"/><polygon fill="#A80036" points="358.5,778.7148,362.5,788.7148,366.5,778.7148,362.5,782.7148" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="228" x2="228" y1="790.2148" y2="808.7148"/><polygon fill="#A80036" points="224,798.7148,228,808.7148,232,798.7148,228,802.7148" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="167.5" x2="167.5" y1="864.1836" y2="882.6836"/><polygon fill="#A80036" points="163.5,872.6836,167.5,882.6836,171.5,872.6836,167.5,876.6836" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="285" x2="285" y1="864.1836" y2="882.6836"/><polygon fill="#A80036" points="281,872.6836,285,882.6836,289,872.6836,285,876.6836" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="228" x2="228" y1="842.6836" y2="862.6836"/><polygon fill="#A80036" points="224,852.6836,228,862.6836,232,852.6836,228,856.6836" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="228" x2="228" y1="557.7813" y2="577.7813"/><polygon fill="#A80036" points="224,567.7813,228,577.7813,232,567.7813,228,571.7813" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="503" x2="503" y1="557.7813" y2="739.2813"/><polygon fill="#A80036" points="499,729.2813,503,739.2813,507,729.2813,503,733.2813" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="503" x2="503" y1="773.25" y2="936.6523"/><polygon fill="#A80036" points="499,926.6523,503,936.6523,507,926.6523,503,930.6523" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="286" x2="286" y1="531.7813" y2="551.7813"/><polygon fill="#A80036" points="282,541.7813,286,551.7813,290,541.7813,286,545.7813" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="286" x2="286" y1="479.3125" y2="497.8125"/><polygon fill="#A80036" points="282,487.8125,286,497.8125,290,487.8125,286,491.8125" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="573" x2="573" y1="479.3125" y2="962.6523"/><polygon fill="#A80036" points="569,952.6523,573,962.6523,577,952.6523,573,956.6523" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="286" x2="286" y1="942.6523" y2="962.6523"/><polygon fill="#A80036" points="282,952.6523,286,962.6523,290,952.6523,286,956.6523" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="300" x2="300" y1="459.3125" y2="477.8125"/><polygon fill="#A80036" points="296,467.8125,300,477.8125,304,467.8125,300,471.8125" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="300" x2="300" y1="1006.6523" y2="1031.0547"/><polygon fill="#A80036" points="296,1021.0547,300,1031.0547,304,1021.0547,300,1025.0547" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="384.5" x2="396.5" y1="994.6523" y2="994.6523"/><polygon fill="#A80036" points="392.5,1038.0391,396.5,1048.0391,400.5,1038.0391,396.5,1042.0391" style="stroke:#A80036;stroke-width:1.5;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="396.5" x2="396.5" y1="994.6523" y2="1097.0234"/><line style="stroke:#A80036;stroke-width:1.5;" x1="396.5" x2="312" y1="1097.0234" y2="1097.0234"/><polygon fill="#A80036" points="322,1093.0234,312,1097.0234,322,1101.0234,318,1097.0234" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="300" x2="300" y1="1065.0234" y2="1085.0234"/><polygon fill="#A80036" points="296,1075.0234,300,1085.0234,304,1075.0234,300,1079.0234" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="300" x2="300" y1="964.1523" y2="982.6523"/><polygon fill="#A80036" points="296,972.6523,300,982.6523,304,972.6523,300,976.6523" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="300" x2="300" y1="1109.0234" y2="1129.0234"/><polygon fill="#A80036" points="296,1119.0234,300,1129.0234,304,1119.0234,300,1123.0234" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[dc576ca50e01eed6854c2c2d56cc7ca6]
@startuml

start
if (Should regen certs or hasn't private key?) is (YES) then
    :Generate CSR and private key;
    :Save private key to file;
    :KeyPEMFile\\
    :Save Agent Token (fingerprint of CSR) to file;
    :AgentTokenFile\\
else (NO)
    :Read private key file;
    :KeyPEMFile\\
    :Generate CSR;
    :Read agent token from file;
    :AgentTokenFile\\
endif

split
    :Server Token/
split again
    :Agent Token/
    note left: It is required
end split

split
    :Send to server;
    fork
        if (Server returns that the agent is already registered?) is (YES) then
            end
        else (NO)
        endif
        split
            :Agent CA cert/
            note right
                Fingerprint of
                this certificate 
                is stored
                in database
            end note
        split again
            :Server CA cert/
        end split
        :Save certs;
        split
            :RootCAFile\\
            detach
        split again
            :CertPEMFile\\
            detach
        end split
    fork again
        :Machine ID/
    end fork

split again
end split

if (Is server token provided?) is (YES) then
    :Ping agent;
else (NO)
endif
end
@enduml

PlantUML version 1.2021.9(Sun Jul 25 12:13:56 CEST 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>